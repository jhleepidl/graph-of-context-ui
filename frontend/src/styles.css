:root { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, 'Apple Color Emoji','Segoe UI Emoji'; }
body { margin: 0; background: #f8fafc; color: #111827; }
button, input, select, textarea { font: inherit; }
.wrap {
  --left-panel-width: 360px;
  --right-panel-width: 360px;
  --panel-resizer-width: 10px;
  display: grid;
  grid-template-columns:
    minmax(260px, var(--left-panel-width))
    var(--panel-resizer-width)
    minmax(520px, 1fr)
    var(--panel-resizer-width)
    minmax(300px, var(--right-panel-width));
  height: 100vh;
  gap: 0;
}
.col { border-right: 1px solid #e5e7eb; overflow: auto; padding: 14px; background: #fbfdff; }
.col-center { background: #f8fafc; }
.col-right { border-right: 0; background: #fbfdff; }
.panelResizer {
  position: relative;
  border-right: 1px solid #e5e7eb;
  border-left: 1px solid #e5e7eb;
  background: #f8fafc;
  cursor: col-resize;
}
.panelResizer::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 2px;
  height: 36px;
  border-radius: 999px;
  background: #cbd5e1;
  transform: translate(-50%, -50%);
}
.panelResizer:hover {
  background: #eef2ff;
}
body.isResizingPanels,
body.isResizingPanels * {
  cursor: col-resize !important;
  user-select: none !important;
}
.row { display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-bottom:10px; }
.pill { display:inline-block; font-size:12px; padding:2px 8px; border-radius:999px; background:#f3f4f6; margin-right:6px; border: 1px solid #e5e7eb; }
.pillType { font-weight: 600; }
.pillActive { background: #ecfdf5; color: #065f46; border-color: #a7f3d0; }
.pill--default { background:#f3f4f6; color:#374151; }
.pill--resource { background:#ecfeff; color:#155e75; border-color:#a5f3fc; }
.pill--fold { background:#ecfdf5; color:#065f46; border-color:#a7f3d0; }
.pill--decision { background:#fef3c7; color:#92400e; border-color:#fcd34d; }
.pill--assumption { background:#ede9fe; color:#5b21b6; border-color:#c4b5fd; }
.pill--plan { background:#dbeafe; color:#1d4ed8; border-color:#93c5fd; }
.pill--candidate { background:#ffedd5; color:#c2410c; border-color:#fdba74; }
.pill--memory { background:#ecfccb; color:#3f6212; border-color:#bef264; }
.card { border: 1px solid #e5e7eb; border-radius: 14px; padding: 10px; margin-bottom: 10px; background: #fff; box-shadow: 0 1px 2px rgba(15, 23, 42, 0.04); }
.card:hover { box-shadow: 0 4px 12px rgba(15, 23, 42, 0.06); }
.muted { color:#6b7280; font-size:12px; }
button { padding: 7px 11px; border-radius: 10px; border:1px solid #d1d5db; background:#fff; cursor:pointer; }
button:hover { background: #f9fafb; }
button.primary { background:#111827; color:#fff; border-color:#111827; }
button.primary:hover { background:#1f2937; }
button.danger { background:#fff; border-color:#ef4444; color:#ef4444; }
button:disabled { opacity: 0.5; cursor: not-allowed; }
input, select, textarea { border:1px solid #d1d5db; border-radius: 10px; background: #fff; }
input:focus, select:focus, textarea:focus { outline: 2px solid rgba(59,130,246,.2); border-color: #93c5fd; }
textarea { width:100%; height: 90px; resize: vertical; padding: 10px; box-sizing: border-box; }
.graphWrap { height: calc(100vh - 24px); min-height: 420px; border:1px solid #eee; border-radius: 12px; overflow:hidden; display:flex; flex-direction:column; }
.graphTools { display:flex; gap:8px; align-items:center; padding:8px; border-bottom:1px solid #eee; background:#fafafa; flex-wrap:wrap; max-height: 42%; overflow: auto; align-content: flex-start; }
.graphCanvas { flex:1 1 320px; min-height:300px; position: relative; }
.graphDetail { border-bottom: 1px solid #eee; background: #fff; padding: 8px; max-height: 180px; overflow: auto; }
.graphDetail pre { margin: 6px 0 0; white-space: pre-wrap; font-size: 12px; }
.graphNodeCard { min-width: 220px; max-width: 220px; border: 1px solid #e5e7eb; border-radius: 12px; padding: 8px; background: #fff; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.04); cursor: default; user-select: none; }
.graphNodeCard.isLayoutEditable { cursor: grab; }
.graphNodeCard.isLayoutEditable:active { cursor: grabbing; }
.graphNodeCard.isActive { border: 2px solid #10b981; box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.18); }
.graphNodeTitle { display: flex; gap: 6px; align-items: center; margin-bottom: 4px; }
.graphNodeSnippet { font-size: 11px; color: #111827; white-space: pre-wrap; }
.graphNodeMeta { margin-top: 6px; font-size: 10px; color: #6b7280; }
.graphNodeDragToActive { margin-top: 6px; display: inline-flex; align-items: center; border: 1px dashed #93c5fd; border-radius: 8px; background: #eff6ff; color: #1d4ed8; font-size: 10px; padding: 3px 6px; cursor: grab; }
.graphNodeDragToActive:hover { background: #dbeafe; }
.graphNodeDragToActive:active { cursor: grabbing; }
.graphNodeExpandToggle { margin-top: 6px; display: inline-flex; align-items: center; border: 1px solid #c7d2fe; border-radius: 8px; background: #eef2ff; color: #3730a3; font-size: 10px; padding: 3px 7px; cursor: pointer; font-weight: 600; }
.graphNodeExpandToggle:hover { background: #e0e7ff; }
.graphHandle { width: 9px; height: 9px; background: #6b7280; border: 1px solid #fff; }
.graphCanvas .react-flow__node-contextNode { background: transparent; border: none; padding: 0; width: auto; }
.graphCanvas .react-flow__node.selected .graphNodeCard { border-color: #2563eb; box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.22); }
.graphNodeActiveDot { position: absolute; top: 8px; right: 8px; width: 10px; height: 10px; border-radius: 999px; border: 1px solid #d1d5db; background: #fff; }
.graphNodeActiveDot.on { background: #10b981; border-color: #059669; box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.16); }
.graphNodeLinkSourceBadge { position: absolute; top: -8px; left: 8px; border-radius: 999px; border: 1px solid #bfdbfe; background: #eff6ff; color: #1d4ed8; font-size: 10px; padding: 1px 6px; font-weight: 600; }
.graphNodeCard.isExpandedFold { border-style: dashed; border-width: 2px; }
.graphNodeCard.isExpandedMember { box-shadow: 0 0 0 2px rgba(5, 150, 105, 0.15); }
.selectionHull { position: absolute; border: 1px dashed rgba(37, 99, 235, 0.75); border-radius: 20px; background: rgba(37, 99, 235, 0.08); pointer-events: none; z-index: 5; }
.selectionCountBadge { position: absolute; transform: translate(-50%, -50%); border-radius: 999px; border: 1px solid #bfdbfe; background: #eff6ff; color: #1d4ed8; font-size: 11px; font-weight: 600; padding: 2px 8px; pointer-events: none; z-index: 6; }
.selectionMenuTrigger { position: absolute; width: 28px; height: 28px; border-radius: 999px; border: 1px solid #2563eb; background: #2563eb; color: #fff; display: inline-flex; align-items: center; justify-content: center; font-size: 14px; line-height: 1; z-index: 7; box-shadow: 0 8px 18px rgba(30, 64, 175, 0.28); }
.selectionMenuTrigger:hover { background: #1d4ed8; }
.selectionContextMenu { position: absolute; z-index: 8; display: flex; flex-direction: column; gap: 6px; min-width: 210px; border: 1px solid #dbeafe; border-radius: 12px; background: rgba(255, 255, 255, 0.98); box-shadow: 0 16px 28px rgba(15, 23, 42, 0.16); padding: 8px; }
.selectionContextMenu button { width: 100%; text-align: left; }
.linkPopover { position: absolute; z-index: 8; min-width: 260px; border: 1px solid #dbeafe; border-radius: 12px; background: rgba(255, 255, 255, 0.98); box-shadow: 0 16px 28px rgba(15, 23, 42, 0.16); padding: 10px; }
.menuError { color: #b91c1c; font-size: 12px; }
.graphLegacyControls summary { cursor: pointer; color: #6b7280; font-size: 12px; }
.graphLegacyControls[open] { background: #f8fafc; border: 1px dashed #cbd5e1; border-radius: 10px; padding: 6px; }
.graphWorkspace { position: relative; }
.nodeDrawer { position: absolute; top: 0; right: 0; bottom: 0; width: min(480px, 92%); z-index: 9; pointer-events: none; }
.nodeDrawerCard { height: 100%; max-height: none; margin: 0; border-left: 1px solid #dbeafe; border-radius: 10px 0 0 10px; box-shadow: -12px 0 28px rgba(15, 23, 42, 0.14); pointer-events: auto; }
.dropZone { border: 1px dashed #d1d5db; border-radius: 10px; padding: 8px 10px; margin-bottom: 10px; font-size: 12px; color: #6b7280; background: #f9fafb; }
.dropZone.addZone { border-color: #93c5fd; background: #eff6ff; color: #1d4ed8; }
.dropZone.removeZone { border-color: #fca5a5; background: #fef2f2; color: #b91c1c; margin-top: 8px; }
.card.dragging { opacity: 0.6; border-style: dashed; }
.activeDropSlot { height: 10px; margin: 4px 0; border-radius: 6px; border: 1px dashed transparent; background: transparent; transition: all 120ms ease; }
.activeDropSlot.isHover { border-color: #2563eb; background: rgba(37, 99, 235, 0.12); }
.tokenBar { width: 100%; height: 10px; border-radius: 999px; background: #e5e7eb; overflow: hidden; margin: 6px 0; }
.tokenBarFill { height: 100%; background: #2563eb; transition: width 160ms ease; }
.tokenBarFill.warn { background: #dc2626; }
.modalOverlay { position: fixed; inset: 0; background: rgba(15, 23, 42, 0.45); display: flex; align-items: center; justify-content: center; padding: 20px; z-index: 999; }
.modalCard { width: min(920px, 100%); max-height: calc(100vh - 40px); overflow: auto; background: #fff; border: 1px solid #e5e7eb; border-radius: 12px; padding: 12px; }
.modalHeader { justify-content: space-between; }
.modalPartList { max-height: 220px; overflow: auto; }

.graphNodeCard { transition: box-shadow 120ms ease, border-color 120ms ease; }
.graphNodeCard.tone-default { border-color: #e5e7eb; background: #ffffff; }
.graphNodeCard.tone-user { border-color: #bfdbfe; background: #eff6ff; }
.graphNodeCard.tone-assistant { border-color: #c7d2fe; background: #eef2ff; }
.graphNodeCard.tone-resource { border-color: #a5f3fc; background: #ecfeff; }
.graphNodeCard.tone-fold { border-color: #a7f3d0; background: #ecfdf5; }
.graphNodeCard.tone-decision { border-color: #fcd34d; background: #fffbeb; }
.graphNodeCard.tone-assumption { border-color: #c4b5fd; background: #f5f3ff; }
.graphNodeCard.tone-plan { border-color: #93c5fd; background: #eff6ff; }
.graphNodeCard.tone-candidate { border-color: #fdba74; background: #fff7ed; }
.graphNodeCard.hierarchy-backbone { min-width: 244px; max-width: 244px; border-width: 2px; box-shadow: 0 3px 0 rgba(15, 23, 42, 0.06); }
.graphNodeCard.hierarchy-user { border-color: #93c5fd; background: #eff6ff; }
.graphNodeCard.hierarchy-assistant { border-color: #a5b4fc; background: #eef2ff; }
.graphNodeCard.hierarchy-detail { min-width: 186px; max-width: 186px; border-color: #dbeafe; background: #f8fafc; box-shadow: inset 0 0 0 1px rgba(148, 163, 184, 0.15); }
.graphNodeCard.hierarchy-detail .graphNodeSnippet { font-size: 10px; color: #334155; }
.graphNodeCard.hierarchy-detail .graphNodeMeta { font-size: 9px; color: #64748b; }
.graphNodeCard.hierarchy-detail .graphNodeDragToActive { font-size: 9px; padding: 2px 5px; }


.selectionActionBar {
  position: sticky;
  top: 0;
  z-index: 5;
  background: rgba(255,255,255,0.84);
  backdrop-filter: blur(6px);
  border-color: #e5e7eb;
  opacity: 0.92;
}
.selectionActionBar .row { row-gap: 6px; }
.graphTools button:disabled { opacity: 0.45; }
.graphStatusPill { font-weight: 600; }
.graphStatusPill--error { border-color: #fecaca; background: #fef2f2; color: #b91c1c; }
@media (max-width: 1360px) {
  .wrap {
    grid-template-columns:
      minmax(240px, var(--left-panel-width))
      var(--panel-resizer-width)
      minmax(460px, 1fr)
      var(--panel-resizer-width)
      minmax(280px, var(--right-panel-width));
  }
}

/* Tablet / split-screen: keep graph visible at the top-right instead of stacking everything */
@media (max-width: 1100px) {
  .wrap {
    grid-template-columns: 280px 1fr;
    grid-template-rows: minmax(420px, 1fr) auto;
    height: 100vh;
  }
  .panelResizer { display: none; }
  .col { min-height: 0; }
  .col-left { grid-column: 1; grid-row: 1 / span 2; }
  .col-center { grid-column: 2; grid-row: 1; }
  .col-right {
    grid-column: 2;
    grid-row: 2;
    border-right: 0;
    border-top: 1px solid #e5e7eb;
    max-height: 42vh;
  }
  .graphWrap { height: calc(100vh - 120px); min-height: 420px; }
}

/* Mobile: stack, but show Graph first so it doesn't look like it disappeared */
@media (max-width: 820px) {
  .wrap { display: flex; flex-direction: column; height: auto; }
  .panelResizer { display: none; }
  .col {
    border-right: 0;
    border-bottom: 1px solid #e5e7eb;
    min-height: 280px;
    overflow: visible;
  }
  .col-center { order: 1; }
  .col-left { order: 2; }
  .col-right { order: 3; max-height: none; border-top: 0; }
  .graphWrap { height: 68vh; min-height: 360px; }
}

.priorityList {
  display: flex;
  flex-direction: column;
  gap: 8px;
}
.priorityRow {
  border: 1px solid #e5e7eb;
  border-radius: 10px;
  padding: 8px;
  background: #fff;
}
.priorityRow.isDim {
  opacity: 0.62;
}
.priorityRowMain {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  align-items: center;
  margin-bottom: 4px;
}
.prioritySnippet {
  white-space: pre-wrap;
  font-size: 12px;
  color: #111827;
  line-height: 1.35;
}
.pill--must {
  background: #fee2e2;
  color: #991b1b;
  border-color: #fca5a5;
  font-weight: 700;
}
.pill--recommend {
  background: #dbeafe;
  color: #1d4ed8;
  border-color: #93c5fd;
  font-weight: 700;
}
.pill--optional {
  background: #fef3c7;
  color: #92400e;
  border-color: #fcd34d;
}
.pill--skip {
  background: #f3f4f6;
  color: #6b7280;
  border-color: #d1d5db;
}

.ruleButtons {
  display: inline-flex;
  gap: 4px;
  align-items: center;
}

button.tiny {
  font-size: 11px;
  line-height: 1;
  padding: 4px 6px;
  border-radius: 8px;
}

button.tiny.isActive {
  border-color: #2563eb;
  box-shadow: inset 0 0 0 1px #93c5fd;
  background: #eff6ff;
}

.contextInspectorStack {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-top: 12px;
}

.inspectorCard {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.inspectorHeader {
  justify-content: space-between;
  align-items: center;
}

.compiledPreview {
  white-space: pre-wrap;
  word-break: break-word;
  max-height: 220px;
  overflow: auto;
  padding: 10px;
  border: 1px solid #e5e7eb;
  border-radius: 10px;
  background: #fafafa;
  font-size: 12px;
  line-height: 1.45;
}

.versionList,
.plannerList {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.versionItem,
.plannerItem,
.diffBox {
  border: 1px solid #e5e7eb;
  border-radius: 10px;
  padding: 8px;
  background: #fff;
}

.pillRow {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}
